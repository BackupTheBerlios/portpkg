<html>
<body>

<div class="wiki view MaintainerGuide">
<div class="text-head">
<h2 class="text-title page title"><a href="doc.php?page=links/MaintainerGuide">MaintainerGuide</a></h2>
</div>
<div class="text-body">

<p>This page addresses the process of creating new ports. Sorry, this page hasn't yet been translated.
</p>

<h2>1. Preparing</h2>
<h3>1.1 Maintainer Mode<sup>1</sup></h3>

<p>For maintaining ports, <tt>portpkg</tt> can make some extra checks to assure the ports have been built correct. So maintainers should have their own tag to have <tt>portpkg</tt> identify their ports. This is done with the first use of <tt>addport</tt> and will be written to the file <tt>/usr/ports/local.conf</tt>, which looks something like this:
</p>





<pre class="markup pre">
MY_TAG=me
MY_EMAIL=myself&#x40;here.org
MY_REALNAME="I. M. Weasel"
</pre>




<p>Tags will be added to the revision number of ports and therefore have to be written in every SlackBuild (<tt>BUILD=1me</tt>).
</p>

<h3>1.2 Classifying Ports</h3>

<p><em>Why is that so important? -- Ports can be tracked as requirements later by other ports. To avoid cluttering we should follow a naming scheme.</em>
</p>


<p>Every package/port is composed of at least 4 segments divided by "-". Count from the tail (by leaving out .tgz): the revision (or build), the architecture (or <tt>noarch</tt> for architecture independend ports), the version and anything remaining is the "name":
</p>





<pre class="markup pre">
this-is-a-package-1.0-noarch-1.tgz
|                 |   |      |
name              ver.arch.  revision</pre>




<p>On naming a new port it is best to come from the source package:
</p>





<pre class="markup pre">
http://download.sourceforge.net/mjpeg/mjpegtools-1.6.2.tar.gz
</pre>




<p>That was easy: The name is <tt>mjpegtools</tt>, the version is <tt>1.6.2</tt>, the architecture would be <tt>i486</tt> an a x86 machine. So  our port will be called <tt>mjpegtools-1.6.2-i486-1me.tgz</tt>, because it is our first try. Now, we make a directory called <tt>mjpegtools</tt> in our group (which is here <tt>ap/</tt>) where all the scripts can be written for this port.
</p>



<p><em>Note: Ports should be portable for other architectures than x86 (<tt>s390</tt> and <tt>x86_64</tt>), so if the code will be architecture-dependend, <tt>ARCH</tt> has to be <tt>{ARCH:-i486}</tt>, which means, that i486 is the </em>default'' architecture, otherwise it has to be <tt>noarch</tt>.
</p>


<p><em>Besides versions cannot have a "-" inside. Futhermore names cannot have capitals.</em>
</p>


<p><hr noshade="noshade" />
</p>

<h2>2. Ports and their Parts</h2>
<h3>2.1 SlackBuild</h3>

<p>The file SlackBuild on its own determines the layout of the resulting package. It is a bash-script and is executed when <tt>portpkg</tt> builds a binary package for installation. Generally, SlackBuilds needs to be specially adjusted to a source package.
</p>


<p>In the root directory of the ports tree, there's a SlackBuild-skeleton, that should be used as template and should be modified step-by-step if it doesn't fit the needs of the installation procedure.
</p>


<p>Please follow the basic filesystem layout in Slackware:
</p>

<table cellpadding="2" border="1" cellspacing="0">
<tr>
<td>Configuration</td>
<td><tt>/etc</tt></td>
</tr><tr>
<td>Variable data</td>
<td><tt>/var/lib</tt></td>
</tr><tr>
<td>Prefix</td>
<td><tt>/usr</tt></td>
</tr>
</table>


<p>The <a href="http://www.pathname.com/fhs/pub/fhs-2.3.html">Filesystem Hierarchy Standard</a>, which is followed by Slackware, makes exceptions only for very few programmes, that are essential for booting the system or for big and closed software packages like <tt>/opt/kde</tt>.
</p>


<p>Executable files in  <tt>bin/</tt> and <tt>sbin/</tt> directories have to be owned by <tt>root.bin</tt>.
</p>


<p>The directory <tt>/usr/local</tt>, which is the default prefix, should never be used for packages, but only for installations by hands. The same is in the other way sround.
</p>


<p><em>"Why does my package have such a fantastic compression ratio?"</em>
</p>


<p>Always have a look at <tt>footprint</tt><sup>1</sup> to find misfits earlier.
</p>


<p>If something doesn't need to be patched, please don't patch it!
</p>

<h3>2.2 doinst.sh</h3>

<p>(...)
</p>

<h3>2.3 sources<sup>1</sup></h3>

<p>Source package URLs should be written in <tt>sources</tt>. To make version updates later easier, use the string $VERSION where the version number of the package is placed. <tt>portpkg</tt> will download these files into the port directory before running the SlackBuild. After that, they will be stored in <tt>/usr/src/dist</tt>. If a file should be saved with a different name than its URL calls it, use a "%" before that. Example:
</p>



<pre class="markup code">
http://www.host.org/downloads/package-$VERSION.tar.gz
http://www.host.org/downloads/package-addon-$VERSION.tar.gz
http://www.host.org/downloads/download.php?file=data%package-data
</pre>



<p>Please list only primary download sites here.
</p>

<h3>2.4 slack-desc</h3>

<p>Example <tt>slack-desc</tt>:
</p>



<pre class="markup pre">
shortname: Projectname (short desciption)
shortname:
shortname: Here can be a longer and deeper going description of the package.
shortname: Note that you do not go behind 75 characters and 11 lines.
</pre>



<h3>2.5 slot-in<sup>1</sup></h3>

<p>Packages a port builds normally are "installed" with <tt>upgradepkg</tt>. That means if another version of the port is already installed, this old one is being replaced with the new one.
</p>


<p>E.g.: <tt>mplayer-1.0pre4-i486-1tom</tt> is already installed, <tt>mplayer-1.0pre5-i486-1tom</tt> is available in the ports, so the command <tt>portpkg mplayer</tt> just removes the first one to install the last one. 
</p>


<p>If this behaviour is not intended, mostly for packages like kernels or kernel-modules, there's the possibility to mark a port as a "slot-in":
</p>





<pre class="markup pre">
# touch slot-in
</pre>



<h3>2.6 pseudo<sup>1</sup></h3>

<p>The empty file <tt>pseudo</tt> marks a "pseudo port", as you can see in the ports tree <tt>sync-dist</tt> builds. These pseudo ports list binary Slackware packages as their souce packages, therefore the presents of <tt>slot-in</tt> instructs <tt>portpkg</tt> not to store them in <tt>/usr/dist</tt> when the installation is done.
</p>


<p><em>Nore: This is more for the sake of completeness, it is subject to be removed if Portpkg implements a way of interacting with Slackware repository tools.</em>
</p>

<h3>2.7 requires<sup>1</sup></h3>

<p>The file <tt>requires</tt> contains dependend packages and ports <tt>portpkg</tt> tracks in the maintainer mode after compiling. These packages and ports are required for compiling this port, so the next time this port is to be build, <tt>portpkg</tt> makes sure, this list is met. You shouldn't write this file by hand normally, but there may be dependencies that cannot be found automatically, then add them. In <tt>requires</tt>, no dependencies will be removed by <tt>portpkg</tt>.
</p>

<h3>2.8 PORT_IS_BROKEN, arbitrary, buildlog, diff, footprint</h3>

<p>Several files are available in maintainer mode to indicate the result of the package making process:
</p>

<table cellpadding="2" border="1" cellspacing="0">
<tr>
<td><tt>PORT_IS_BROKEN</tt></td>
<td>Marks a failure of the last compilation</td>
</tr><tr>
<td><tt>arbitrary</tt></td>
<td>Lists any dependency from <tt>requires</tt> that couldn't be tracked automatically</td>
</tr><tr>
<td><tt>buildlog</tt></td>
<td>Is a detailed log of the SlackBuild-output</td>
</tr><tr>
<td><tt>diff</tt></td>
<td>Is a comparison to the SlackBuild-skeleton</td>
</tr><tr>
<td><tt>footprint</tt></td>
<td>Is a file list of the package content</td>
</tr>
</table>


<p><hr noshade="noshade" />
</p>

<h2>3. The Configuration of Portpkg<sup>1</sup></h2>
<h3>3.1 local.conf</h3>
<table cellpadding="2" border="1" cellspacing="0">
<tr>
<td><tt>MY_TAG</tt>=tag</td>
<td>Your personal tag</td>
</tr><tr>
<td><tt>MY_EMAIL</tt>=email</td>
<td>Your mail address for contacting you if you plan to contribute</td>
</tr><tr>
<td><tt>MY_REALNAME</tt>="real name"</td>
<td>Your real name for contacting you if you plan to contribute</td>
</tr><tr>
<td><tt>MAINTAIN_ALL=true</tt></td>
<td>Let <tt>portpkg</tt> always work in maintainer mode</td>
</tr><tr>
<td><tt>DIST_VER</tt>=version</td>
<td>The target Slackware version if you use <tt>sync-dist</tt> or <tt>sync-slack</tt></td>
</tr><tr>
<td><tt>verbose=true</tt></td>
<td>Let <tt>portpkg</tt> always work in verbose mode (<tt>--verbose</tt>)</td>
</tr><tr>
<td><tt>no_reqs=true</tt></td>
<td>Let <tt>portpkg</tt> always work without requirements resolving (<tt>--noreqs</tt>)</td>
</tr>
</table>

<h3>3.2 mirrors and mirrors.local</h3>

<p>While in <tt>sources</tt> you should list the primary download URLs, in <tt>mirrors</tt> there're global mirror sites for common source package locations. If you want to have some special mirror sites for your own, write them into <tt>mirrors.local</tt>.
</p>

<h3>3.3 ignore and ignore.local</h3>

<p>Normally, dependencies are tracked automatically by <tt>portpkg</tt> in the maintainer mode after compiling and written to the file <tt>requires</tt>. If you find any dependencies in <tt>requires</tt> that shouldn't be tracked, write them into <tt>ignore.local</tt>:
</p>


  <ul type="circle">
  <li> Packages or ports, that are optional: mostly newer versions of libraries included in other Slackware packages (e.g. freetype, fontconfig etc. are already included in Slackware's x11 package)</li>
  <li> Packages or ports being useless to track, because they're already and for sure installed (e.g. aaa_elflibs)  </li>
  </ul>


<p>A global list of common ignored dependencies is in <tt>ignore</tt>.
</p>

<h3>3.4 exclude and exclude.local</h3>

<p>(...)
</p>


<p><hr noshade="noshade" />
</p>


<p><em>Note: <sup>1</sup> specific to the programme <tt>portpkg</tt></em>
</p>



</div>
<div class="wiki-plugins">

<div align="right" class="action-links control-links">
<br />
<hr noshade="noshade" />
  <a href="doc.php?page=edit/MaintainerGuide">EditThisPage</a>   <a href="doc.php?page=links/MaintainerGuide">BackLinks</a>   <a href="doc.php?page=info/MaintainerGuide">PageInfo</a>   <small>last changed on Sat Dec 04 11:50:11 2004</small></div>
</div>

</div>

</body>
</html>
