#BLURB="The Portpkg ports collection"

# check that we're a plug-in
if [ "`basename $0`" != "portpkg" ]; then
  echo "Don't run me directly!"
  exit 1
fi

root=`mirror cvs://:pserver:anonymous@cvs.berlios.de:/cvsroot/portpkg/ports`

row "Syncing $PRT_DIR/ with `echo $root | cut -d @ -f 2`"

[ -d $PRT_DIR/.CVS ] && find $PRT_DIR/ -name .CVS | xargs -r rename .CVS CVS

if [ -d $PRT_DIR ]; then
  cd $PRT_DIR
  cvs -qz9 up -dP -I z -I 0 . 2>/dev/null
else
  mkdir -p $PRT_DIR
  cd `dirname $PRT_DIR`
  cvs -qz9 -d `dirname $root` co -Pd `basename $PRT_DIR` `basename $root` 2>/dev/null
fi | sed -r \
  -e "s,^U ,Updating ," \
  -e "s,^P ,Patching ," \
  -e "s,^C (.*)$,\1 conflicts with repository," \
  -e "s,^M (.*)$,\1 is locally modified," \
  -e "s,^\\? ,Unknown entry ," \
  -e "s,.*,  --> &,"
