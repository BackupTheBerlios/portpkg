--- hal-0.2.98/hald/linux/block_class_device.c~	2004-09-23 14:25:49.569548456 +0200
+++ hal-0.2.98/hald/linux/block_class_device.c	2004-09-23 14:25:49.569548456 +0200
@@ -64,6 +64,8 @@
 #include "drive_id/drive_id.h"
 #include "linux_dvd_rw_utils.h"
 
+#define BLKGETSIZE64 _IOR(0x12,114,sizeof(uint64_t))   /* return device size in bytes (u64 *arg) */
+
 /**
  * @defgroup HalDaemonLinuxBlock Block device class
  * @ingroup HalDaemonLinux
--- hal-0.4.1/configure.in~	2004-11-02 14:55:20.638793320 +0100
+++ hal-0.4.1/configure.in	2004-11-02 14:55:20.638793320 +0100
@@ -235,25 +235,6 @@
 AM_CONDITIONAL(DOXYGEN_DOCS_ENABLED, test x$enable_doxygen_docs = xyes)
 AC_MSG_RESULT(yes)
 
-# Check for BLKGETSIZE64
-AC_MSG_CHECKING(for BLKGETSIZE64)
-AC_TRY_COMPILE(
-[#include <sys/types.h>
-#include <linux/ioctl.h>
-#include <linux/fs.h>],
-[int main(int argc, char *argv[])
-{
-	int fd = 0;
-	unsigned long long int n;
-	ioctl (fd, BLKGETSIZE64, &n);
-	return 0;
-}
-], have_size64=yes, have_size64=no)
-AC_MSG_RESULT($have_size64)
-if test x$have_size64 = xno; then
-  AC_MSG_ERROR([BLKGETSIZE64 is not defined])
-fi
-
 # DocBook Documentation
 
 AC_PATH_PROG(DOCBOOK, docbook2html, no)
